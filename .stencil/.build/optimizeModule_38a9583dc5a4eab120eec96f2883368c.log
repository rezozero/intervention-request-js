import{r as i,c as t,h as s,H as e,g as h}from"./p-2cfe6928.js";import{s as r}from"./p-0fc70b91.js";import{i as n}from"./p-4326a25e.js";const o=":host{--ir-object-fit:fill;--ir-object-position:inherit;--ir-width:100%;--ir-height:auto;--ir-max-width:none;--ir-max-height:none;display:block}img{object-fit:var(--ir-object-fit);object-position:var(--ir-object-position);font-family:'object-fit';display:block;width:var(--ir-width);height:var(--ir-height);max-width:var(--ir-max-width);max-height:var(--ir-max-height)}";const a=class{constructor(s){i(this,s);this.loadingCompleted=t(this,"loadingCompleted",7);this.src=undefined;this.alt=undefined;this.crop=undefined;this.fit=undefined;this.width=undefined;this.height=undefined;this.strategy=undefined;this.baseUrl=undefined;this.media=undefined;this.mimeType=undefined;this.forceIo=undefined;this.loading=undefined;this.loaded=false}sourceHandler(){if(window.interventionRequestJS&&window.interventionRequestJS.debug){console.log("src changed",this.observer)}this.resetMedia();this.initObserver()}componentWillLoad(){this.strategyInstance=r[this.strategy];this.isWebp=n(this.src);this.nativeLoading="loading"in HTMLImageElement.prototype&&!this.forceIo;if(!this.strategyInstance&&window.interventionRequestJS&&window.interventionRequestJS.debug){console.error("strategy error",`${this.strategy} strategy is missing`)}}componentDidLoad(){if(this.nativeLoading||this.loading!=="lazy"){this.loadMedia()}else{this.initObserver()}}initObserver(){this.observer=new IntersectionObserver((i=>this.onIntersect(i)));this.observer.observe(this.el)}onIntersect(i){i.forEach((i=>{if(i.isIntersecting){this.observer.disconnect();this.loadMedia()}}))}loadMedia(){const i=this.el.querySelectorAll("source, img");i.forEach((i=>{if(i.dataset.src){i.setAttribute("src",i.dataset.src)}if(i.dataset.srcset){i.setAttribute("srcset",i.dataset.srcset)}}))}resetMedia(){const i=this.el.querySelectorAll("source, img");i.forEach((i=>{i.removeAttribute("src");i.removeAttribute("srcset")}))}onReady(){this.loaded=true;if(this.loadingCompleted){this.loadingCompleted.emit(true)}}onError(){}buildPicture(){let i=[];let t;let e=this.crop||this.fit;let h=this.width;let r=this.height;if(this.media&&this.media.length){i=this.media.map(((i,n)=>{let o=[];let a=[];i.srcset=i.srcset.filter((i=>!!i.format));if(i.srcset&&i.srcset.length){o=i.srcset.map(((s,h)=>{if(n===this.media.length-1&&h===i.srcset.length-1){e=s.format.crop||s.format.fit;t=this.strategyInstance.formatPath(this.src,s,this.baseUrl)}return`${this.strategyInstance.formatPath(this.src,s,this.baseUrl,true)}`}))}if(o.length){if(this.strategyInstance.webp&&!this.isWebp){a.push(s("source",{type:"image/webp",media:i.rule,"data-srcset":o.join(", ").replace(new RegExp(this.src,"g"),`${this.src}.webp`)}))}a.push(s("source",{type:this.mimeType,media:i.rule,"data-srcset":o.join(", ")}));if(e){const i=e.split("x");h=parseInt(i[0]);r=parseInt(i[1])}if(t){a.push(s("img",{width:h,height:r,sizes:i.rule,alt:this.alt||this.src,loading:this.loading,"data-src":t,"data-srcSet":o.join(", "),onLoad:()=>this.onReady(),onError:()=>this.onError()}))}}return a}))}else{const n={};h=h||window.innerWidth;r=r||Math.floor(window.innerWidth*3/4);if(e){const i=e.split("x");h=parseInt(i[0]);r=parseInt(i[1])}if(window.interventionRequestJS){n.format=Object.assign(Object.assign({},window.interventionRequestJS.mediaOptions),{width:h,height:r})}t=this.strategyInstance.formatPath(this.src,n,this.baseUrl);if(this.strategyInstance.webp&&!this.isWebp){i.push(s("source",{type:"image/webp","data-srcset":`${t}.webp`}))}i.push(s("source",{type:this.mimeType,"data-srcset":t}),s("img",{width:h,height:r,alt:this.alt||this.src,loading:this.loading,"data-src":t,onLoad:()=>this.onReady(),onError:()=>this.onError()}))}return s("picture",null,i)}render(){return s(e,{class:{loaded:this.loaded}},this.strategyInstance&&this.buildPicture())}get el(){return h(this)}static get watchers(){return{src:["sourceHandler"]}}};a.style=o;export{a as intervention_request_picture};